<!DOCTYPE html>
{% load static %}
{% load bootstrap_icons %}
{% load i18n %}

<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="shortcut icon" type="image/png" href="{% static '/dart/icons/dart.ico' %}"/>

    {# Bootstrap 5 #}
    <link rel="stylesheet" href="{% static 'bootstrap-5.3.6-dist/css/bootstrap.min.css' %}"/>
    <link rel="stylesheet" href="{% static 'bootstrap-icons-1.13.1/bootstrap-icons.min.css' %}"/>
    <script type="text/javascript" src="{% static 'bootstrap-5.3.6-dist/js/bootstrap.bundle.min.js' %}"></script>

    <script type="text/javascript" src="{% static 'jquery-3.7.1.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'htmx-2.0.4/js/htmx.js' %}"></script>
    <script type="text/javascript" src="{% static 'htmx-2.0.4/js/multi-swap.js' %}"></script>
    <script type="text/javascript" src="{% static 'htmx-2.0.4/js/ws.js' %}"></script>

    <link rel="stylesheet" href="{% static 'dart.css' %}"/>

    {% block extra_style %}{% endblock %}

    <title>{% block sitetitle %}DFO At-sea Reporting Template{% endblock %} {% block subtitle %}{% endblock %}</title>
    {% block header %}{% endblock header %}
</head>
<body hx-ext="multi-swap">

{% block nav_bar_block %}
<nav class="navbar  justify-content-between navbar-expand navbar-light bg-light">

    <div class="container-fluid">
        <ul class="navbar-nav">
            {% block header_buttons %}
            {% if home_url %}
            <li class="nav-item ms-2">
                <a class="btn btn-primary" href="{{ home_url }}" title="{% trans 'Missions' %}">
                {% custom_icon 'house' %}</a>
            </li>
            {% endif %}
            {% endblock %}
        </ul>
        {% if reports %}
        <ul class="navbar-nav">
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                   aria-expanded="false">
                    {% trans 'Download Report' %}
                </a>
                {% block report %}
                <ul class="dropdown-menu">
                    {% for key,report in reports.items %}
                    <li><a class="dropdown-item" href="{{ report }}">{{ key }}</a></li>
                    {% endfor %}
                </ul>
                {% endblock %}
            </li>
        </ul>
        {% endif %}
        <ul class="navbar-nav">
            {% block nav_button_block %}

            {% endblock %}
        </ul>
    </div>
</nav>
{% endblock %}

<div class="container{% if wide_format %}-fluid{% endif %}" hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'>
    <div id="page_title_area" class="row mt-2">
        {% block title %}{% if page_title %}
        <div class="h2 col">{{page_title}}</div>
        {% endif %}{% endblock title %}
    </div>
    <div id="page_content_area" class="row mt-2">
        {% include 'modal.html' %}
        {% block content %}{% endblock content %}
    </div>

    {% block post_content %}
    <div class="container-fluid mt-2">
        <div class="d-flex align-items-end flex-column mb-3">
            <div class="align-self-stretch">
            </div>
            <div>
                {% if dart_version %}
                <div class="border">DART: {{ dart_version }}</div>
                {% endif %}
                <div class="border">Git: {{ git_version }}</div>
            </div>
        </div>
    </div>
    {% endblock post_content %}

</div>

<script>
    {# This is to handle htmx errors so the user doesn't end up staring at an infinite save/load dialog #}
    document.addEventListener('htmx:responseError', function(evt) {
        let element_id = evt.target.id;
        let bad_element = document.getElementById(element_id);
        let replace_with = document.createElement('div');
        let error_text = document.createTextNode("{% trans "Something went wrong, check ./logs/error.log" %}")
        replace_with.id = element_id;
        replace_with.setAttribute('class', 'alert alert-danger mt-2');
        replace_with.append(error_text)
        if(bad_element) {
            bad_element.parentNode.replaceChild(replace_with, bad_element);
        }
    });

    document.body.addEventListener('closeModal', function() {
        var modal = bootstrap.Modal.getOrCreateInstance(document.getElementById('modal'));
        modal.hide();
    });

</script>
{% block body_js %}{% endblock %}

</body>

</html>